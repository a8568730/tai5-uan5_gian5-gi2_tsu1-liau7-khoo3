# -*- coding: utf-8 -*-
"""
著作權所有 (C) 民國102年 意傳文化科技
開發者：薛丞宏
網址：http://意傳.台灣
語料來源：請看各資料庫內說明

本程式乃自由軟體，您必須遵照SocialCalc設計的通用公共授權（Common Public Attribution License, CPAL)來修改和重新發佈這一程式，詳情請參閱條文。授權大略如下，若有歧異，以授權原文為主：
	１．得使用、修改、複製並發佈此程式碼，且必須以通用公共授權發行；
	２．任何以程式碼衍生的執行檔或網路服務，必須公開該程式碼；
	３．將此程式的原始碼當函式庫引用入商業軟體，且不需公開非關此函式庫的任何程式碼

此開放原始碼、共享軟體或說明文件之使用或散佈不負擔保責任，並拒絕負擔因使用上述軟體或說明文件所致任何及一切賠償責任或損害。

臺灣言語工具緣起於本土文化推廣與傳承，非常歡迎各界用於商業軟體，但希望在使用之餘，能夠提供建議、錯誤回報或修補，回饋給這塊土地。

感謝您的使用與推廣～～勞力！承蒙！
"""
from 臺灣言語工具.資料庫.資料庫連線 import 資料庫連線
from 臺灣言語工具.資料佮語料匯入整合.教育部臺灣客家語常用詞辭典.客話辭典正規化 import 客話辭典正規化
from 臺灣言語工具.字詞組集句章.解析整理.拆文分析器 import 拆文分析器
from 臺灣言語工具.字詞組集句章.解析整理.物件譀鏡 import 物件譀鏡
from 臺灣言語工具.資料庫.欄位資訊 import 版本正常
from 臺灣言語工具.資料庫.欄位資訊 import 字詞
from 臺灣言語工具.資料庫.整合.整合入言語 import 加文字佮版本
from 臺灣言語工具.資料佮語料匯入整合.教育部臺灣客家語常用詞辭典.調號處理 import 調號處理
from 臺灣言語工具.字詞組集句章.解析整理.轉物件音家私 import 轉物件音家私
from 臺灣言語工具.資料庫.欄位資訊 import 四縣腔
from 臺灣言語工具.資料庫.欄位資訊 import 海陸腔
from 臺灣言語工具.資料庫.欄位資訊 import 大埔腔
from 臺灣言語工具.資料庫.欄位資訊 import 饒平腔
from 臺灣言語工具.資料庫.欄位資訊 import 詔安腔
from 臺灣言語工具.資料庫.欄位資訊 import 國語臺員腔
from 臺灣言語工具.資料庫.整合.整合入言語 import 加關係
from 臺灣言語工具.資料庫.欄位資訊 import 義近
from 臺灣言語工具.資料庫.欄位資訊 import 會當替換
from 臺灣言語工具.字詞組集句章.基本元素.公用變數 import 標點符號
from 臺灣言語工具.字詞組集句章.音標系統.客話.臺灣客家話拼音 import 臺灣客家話拼音


教育部客家語辭典名 = '教育部臺灣客家語常用詞辭典'
教育部客家語辭典地區 = '臺員'
教育部客家語辭典年代 = 100


揣全部資料 = 資料庫連線.prepare('SELECT "編號","詞目","詞性","四縣音","海陸音","大埔音","饒平音","詔安音","釋義","近義詞","反義詞","文白讀","又音","多音字","對應華語" FROM "教育部臺灣客家語常用詞辭典"."網頁資料"')


class 整合客話辭典():
	def __init__(self):
		辭典正規化 = 客話辭典正規化()
		分析器 = 拆文分析器()
		全部資料 = 揣全部資料()
		譀鏡 = 物件譀鏡()
		轉音家私 = 轉物件音家私()
		調號 = 調號處理()
		def 初使音標(self, 音):
			self.音 = 音
		def 標準音標(self):
			return 調號.數字轉調號(self.音, self.腔)
		算 = 0
		for 編號, 詞目, 詞性, 四縣音, 海陸音, 大埔音, 饒平音, 詔安音, 釋義, 近義詞, 反義詞, \
				文白讀, 又音, 多音字, 對應華語 in 全部資料:
			if 詞性.strip() == '諺':
				種類 = '語句'
			else:
				種類 = '字詞'
			對應華語 = 對應華語.strip()
			流水號集 = []
			if 對應華語 == '' or '〔見' in 對應華語:
				國語詞 = 詞目
				流水號 = 加文字佮版本(教育部客家語辭典名, 種類, 國語臺員腔, 教育部客家語辭典地區,
					教育部客家語辭典年代, 國語詞, '', 版本正常)
				流水號集.append(流水號)
			else:
				國語詞 = 對應華語
				for 標點 in 標點符號:
					國語詞 = 國語詞.replace(標點, ' ')
				for 數字 in range(10):
					國語詞 = 國語詞.replace(str(數字), ' ')
				for 詞 in 國語詞.split():
					print(詞)
					流水號 = 加文字佮版本(教育部客家語辭典名, 種類, 國語臺員腔, 教育部客家語辭典地區,
						教育部客家語辭典年代, 詞, '', 版本正常)
					流水號集.append(流水號)
# 			print(教育部客家語辭典名, 種類, 國語臺員腔, 教育部客家語辭典地區,
# 				教育部客家語辭典年代, 國語詞, '', 版本正常)
			for 音標, 腔 in [(四縣音, 四縣腔), (海陸音, 海陸腔), (大埔音, 大埔腔),  # 粵臺片
					(饒平音, 饒平腔), (詔安音, 詔安腔)]:
				新音 = 辭典正規化.處理音標(音標)
				if 新音 != '':
					try:
# 						換音 = {'han113 fa53 rhid21 tai53 doi33 zhin53 gin33 mo113 rhid21 pied54':
# 						'han113 fa53 rhid21 tai53 doi33, zhin53 gin33 mo113 rhid21 pied54',
# 						'mang11 shid5 ng53 ngied5 zied2 zung53 o53 po55 m55 ho53 ngib5 vung53':
# 						'mang11 shid5 ng53 ngied5 zied2 zung53, o53 po55 m55 ho53 ngib5 vung53',
# 						'cai55 ga11 cien11 ngid24 hoo31 chid24 mun53 ban31 zhio11 nan53':
# 						'cai55 ga11 cien11 ngid24 hoo31, chid24 mun53 ban31 zhio11 nan53',
# 						'teu55 na55 cab2 vo55 chan53 liau55 diau11':
# 						'teu55 na55 cab2 vo55 chan53 －－ liau55 diau11',
# 						'uai33 zhoi53 choi33 lab54 ba31，rhid21 ton113 sia113 ki53':
# 						'uai33 zhoi53 choi33 lab54 ba31 －－ rhid21 ton113 sia113 ki53',
# 						'gung33 bud21 li113 po113 chin53 bud21 li113 to113':
# 						'gung33 bud21 li113 po113, chin53 bud21 li113 to113',
# 						'ho53 ma11 m55 shid5 shid5 fui55 teu55 co53':
# 						'ho53 ma11 m55 shid5 fui55 teu55 co53',
# 						'han113 fa53 rhid21 tai53 doi33 zhin53 gin33 mo113 rhid21 pied54':
# 						'han113 fa53 rhid21 tai53 doi33, zhin53 gin33 mo113 rhid21 pied54',
# 						}
# 						if 新音 in 換音:
# # 							print('{0}\n{1}\n{2}\n音標改正：{3}'.
# # 								format(編號, 詞目, 新音, 換音[新音]))
# 							新音 = 換音[新音]
# 							新詞目 = 詞目
						if 詞目 == '時錶仔' and 新音 == 'shi55 biau24':
							新詞目 = '時錶'
						elif 詞目 == '磨刀仔' and 新音 == 'no55 do53':
							新詞目 = '磨刀'
						elif 詞目 == '紙炮仔' and 新音 == 'zhi24 pau11':
							新詞目 = '紙炮'
						elif 詞目 == '毆□死' and 新音 == 'eu55 bun11 gi55 si53':
							新詞目 = '毆分佢死'
						elif 詞目 == '竹馬仔' and 新音 == 'zhug5 ma53':
							新詞目 = '竹馬'
						elif 詞目 == '魚脯仔' and 新音 == 'ng55 pu24':
							新詞目 = '魚脯'
						elif 詞目 == '做粄仔' and 新音 == 'zo11 ban24':
							新詞目 = '做粄'
						elif 詞目 == '嫩葉仔' and 新音 == 'nun33 rhab2':
							新詞目 = '嫩葉'
						elif 詞目 == '茶壺仔' and 新音 == 'ca55 fu55':
							新詞目 = '茶壺'
						elif 詞目 == '嬰兒仔' and 新音 == 'o53 nga11':
							新詞目 = '嬰兒'
						elif 詞目 == '梅仔樹' and 新音 == 'moi55 shu33':
							新詞目 = '梅樹'
						elif 詞目 == '種痘仔' and 新音 == 'zhung11 teu33':
							新詞目 = '種痘'
						elif 詞目 == '送鬼仔' and 新音 == 'sung11 gui24':
							新詞目 = '送鬼'
						elif 詞目 == '頭臥臥仔' and 新音 == 'teu55 ngo11 ngo11':
							新詞目 = '頭臥臥'
						elif 詞目 == '時鐘仔' and 新音 == 'shi55 zhung53':
							新詞目 = '時鐘'
						else:
							新詞目 = 詞目
						新音 = 新音.replace('9', '31')
						句物件 = 分析器.產生對齊句(新詞目, 新音)
						腔型 = type('腔', (object,), {'__init__' : 初使音標, '腔':腔, '標準音標' :標準音標})
						調號句物件 = 轉音家私.轉做標準音標(腔型, 句物件)
						新句物件 = 轉音家私.轉做標準音標(臺灣客家話拼音, 調號句物件)
					except Exception as 錯誤:
						print('錯誤！！ {0}，{1}，{2}，{5}，原音標：{3}，{4}'.
							format(編號, 詞目, type(錯誤), 新音, 音標, 錯誤))
						算 += 1
# 					print(譀鏡.看型(句物件), 譀鏡.看音(句物件))
					else:
# 						print(教育部客家語辭典名, 字詞, 腔, 教育部客家語辭典地區,
# 									教育部客家語辭典年代, 譀鏡.看型(新句物件), 譀鏡.看音(新句物件), 版本正常)
						流水號 = 加文字佮版本(教育部客家語辭典名, 字詞, 腔, 教育部客家語辭典地區,
 									教育部客家語辭典年代, 譀鏡.看型(新句物件), 譀鏡.看音(新句物件), 版本正常)
						for 進前流水號 in 流水號集:
							加關係(進前流水號, 流水號, 義近, 會當替換)
							加關係(流水號, 進前流水號, 義近, 會當替換)
						流水號集.append(流水號)
		print(算)


if __name__ == '__main__':
	整合客話辭典()
